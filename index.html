<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TreasureBook Builder - O Presente Perfeito</title>
    <style>
        :root { --cor-amor: #ff4d6d; --bg-grad: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg-grad); color: white; min-height: 100vh; }
        .container { max-width: 500px; margin: auto; padding: 20px; }
        .card-editor { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); padding: 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { text-align: center; color: #ffeb3b; font-size: 28px; margin-bottom: 5px; }
        label { display: block; margin: 15px 0 5px; font-weight: bold; color: #ffeb3b; }
        input, textarea, select { width: 100%; padding: 12px; border-radius: 10px; border: none; margin-bottom: 10px; box-sizing: border-box; background: rgba(255,255,255,0.9); }
        .btn-generate { width: 100%; padding: 20px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; font-size: 18px; background: #28a745; color: white; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4); margin-top: 20px; }
        .status { text-align: center; color: #ffeb3b; display: none; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="card-editor">
        <h2>TreasureBook Builder üìï</h2>
        <p style="text-align: center; margin-top: 0;">Crie um presente inesquec√≠vel</p>
        
        <label>Nome de quem recebe:</label>
        <input type="text" id="nome" placeholder="Ex: Mayara">

        <label>Data de In√≠cio (Contador):</label>
        <input type="datetime-local" id="dataInicio">

        <label>Sua Declara√ß√£o:</label>
        <textarea id="mensagem" placeholder="Escreva aqui tudo o que sente..."></textarea>

        <label>Foto da Capa (Aparece no in√≠cio):</label>
        <input type="file" id="foto1" accept="image/*">

        <label>Foto Surpresa (Aparece no bot√£o):</label>
        <input type="file" id="foto2" accept="image/*">
        
        <label>M√∫sica de Fundo (.mp3):</label>
        <input type="file" id="musica" accept="audio/*">

        <button class="btn btn-generate" onclick="processarEBaixar()">GERAR TREASUREBOOK PARA WHATSAPP</button>
        <p id="status" class="status">‚ú® Criando sua m√°gica... Aguarde.</p>
    </div>
</div>

<script>
    async function toBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    }

    async function processarEBaixar() {
        const nome = document.getElementById('nome').value;
        const data = document.getElementById('dataInicio').value;
        const msg = document.getElementById('mensagem').value;
        const f1 = document.getElementById('foto1').files[0];
        const f2 = document.getElementById('foto2').files[0];
        const musicaFile = document.getElementById('musica').files[0];
        const status = document.getElementById('status');

        if(!nome || !data || !f1 || !f2) {
            alert("Preencha todos os campos e selecione as duas fotos!");
            return;
        }

        status.style.display = 'block';

        const b64_foto1 = await toBase64(f1);
        const b64_foto2 = await toBase64(f2);
        let b64_musica = "";
        if(musicaFile) b64_musica = await toBase64(musicaFile);

        const template = `
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para meu grande amor</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"><\/script>
    <style>
        body { margin: 0; background: #0b0b1a; color: #fff; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; perspective: 1000px; overflow-x: hidden; }
        .book-container { position: relative; width: 300px; height: 400px; transition: transform 1.5s; transform-style: preserve-3d; cursor: pointer; }
        .cover { position: absolute; width: 100%; height: 100%; background: #800000; border-radius: 5px 15px 15px 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; backface-visibility: hidden; border-left: 10px solid #4a0000; box-shadow: 20px 20px 60px rgba(0,0,0,0.7); z-index: 2; transition: 1s; }
        .book-open { transform: rotateY(-140deg); opacity: 0; }
        .content { display: none; width: 90%; max-width: 450px; text-align: center; animation: fadeIn 2s forwards; margin: 20px auto; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .photo-main { width: 100%; border-radius: 15px; margin: 20px 0; border: 3px solid #ff4d6d; }
        .counter { background: rgba(255, 77, 109, 0.2); padding: 15px; border-radius: 15px; font-size: 1.1em; color: #ffeb3b; margin-bottom: 20px; border: 1px solid #ff4d6d; }
        .message { background: white; color: #333; padding: 25px; border-radius: 20px; text-align: left; line-height: 1.6; position: relative; margin-bottom: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .coupon { background: #fff; color: #ff4d6d; border: 2px dashed #ff4d6d; padding: 10px; margin: 5px; display: inline-block; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .coupon.used { background: #eee; color: #ccc; border-color: #ccc; text-decoration: line-through; }
        .surprise-btn { background: #ff4d6d; color: white; padding: 15px 30px; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; margin: 20px 0; font-size: 16px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        #fotoSurpresa { width: 100%; border-radius: 15px; display: none; margin-top: 15px; border: 3px solid #ffeb3b; }
    </style>
</head>
<body>
    <div id="book" class="book-container" onclick="abrirLivro()">
        <div class="cover">
            <span style="font-size: 80px;">üìï</span>
            <h2 style="margin: 10px 0;">TreasureBook</h2>
            <p>Toque para abrir,<br>${nome}</p>
        </div>
    </div>

    <div id="mainContent" class="content">
        <h1 style="color: #ff4d6d; margin-bottom: 5px;">Para: ${nome} ‚ù§Ô∏è</h1>
        <div class="counter" id="timer">Calculando nosso tempo...</div>
        
        <img src="${b64_foto1}" class="photo-main">
        
        <div class="message">${msg.replace(/\n/g, '<br>')}</div>

        <p style="font-weight: bold;">üéÅ Seus Mimos (Toque para usar):</p>
        <div class="coupon" onclick="usarCupom(this)">üéüÔ∏è Vale Beijo</div>
        <div class="coupon" onclick="usarCupom(this)">üéüÔ∏è Vale Jantar</div>
        <div class="coupon" onclick="usarCupom(this)">üéüÔ∏è Massagem</div>

        <br>
        <button class="surprise-btn" onclick="revelarSurpresa()">CLIQUE PARA UMA SURPRESA üì∏</button>
        <img src="${b64_foto2}" id="fotoSurpresa">

        <audio id="player" loop src="${b64_musica}"></audio>
        <p style="font-size: 12px; color: #666; margin-top: 40px;">TreasureBook - Feito com Amor</p>
    </div>

    <script>
        function abrirLivro() {
            document.getElementById('book').classList.add('book-open');
            setTimeout(() => {
                document.getElementById('book').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                const p = document.getElementById('player');
                if(p.src) p.play();
                setInterval(updateTimer, 1000);
                lancarConfete();
            }, 1000);
        }

        function updateTimer() {
            const start = new Date("${data}").getTime();
            const now = new Date().getTime();
            const d = now - start;
            const dias = Math.floor(d / (1000 * 60 * 60 * 24));
            const horas = Math.floor((d % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const min = Math.floor((d % (1000 * 60 * 60)) / (1000 * 60));
            const seg = Math.floor((d % (1000 * 60)) / 1000);
            document.getElementById('timer').innerHTML = \`<strong>Juntos h√°:</strong><br>\${dias}d \${horas}h \${min}m \${seg}s\`;
        }

        function usarCupom(el) {
            if(!el.classList.contains('used')) {
                el.classList.add('used');
                lancarConfete();
            }
        }

        function revelarSurpresa() {
            const f = document.getElementById('fotoSurpresa');
            f.style.display = 'block';
            f.scrollIntoView({ behavior: 'smooth' });
            lancarConfete();
        }

        function lancarConfete() {
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#ff4d6d', '#ffeb3b', '#ffffff'] });
        }
    <\/script>
</body>
</html>`;

        const blob = new Blob([template], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `TreasureBook_${nome}.html`;
        a.click();
        status.innerText = "‚úÖ Sucesso! Arquivo baixado.";
    }
</script>
</body>
</html>
